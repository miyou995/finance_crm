{# templates/tables/bootstrap_htmx.html #}
{% extends "django_tables2/bootstrap5.html" %}
{% load django_tables2 %}
{% load i18n %}


{% block table-wrapper %}
    <div class="table-container table-responsive rounded">
        {% block table %}
            {{ block.super }}
        {% endblock table %}

        {% block pagination %}
            <div class="d-flex justify-content-between align-items-center mt-3">
                {% if table.page and table.paginator.num_pages > 1 %}
                    <div class="w-150px">
                        <select 
                            hx-get="{{table.url}}{% querystring %}"
                            hx-trigger="change"
                            hx-target="closest div.table-container"
                            hx-swap="innerHTML"
                            name="per_page" class="d-flex form-select form-select-solid form-select-lg fw-bold per-page-select" 
                        >
                            <option value="10" {% if request.GET.per_page == '10' %}selected{% endif %}>10</option>
                            <option value="30" {% if request.GET.per_page == '30' %}selected{% endif %}>30</option>
                            <option value="50" {% if request.GET.per_page == '50' %}selected{% endif %}>50</option>
                            <option value="100" {% if request.GET.per_page == '100' %}selected{% endif %}>100</option>
                        </select>
                    </div>

                    <nav aria-label="Table navigation">
                        <ul class="pagination justify-content-center">
                            {% if table.page.has_previous %}
                                {% block pagination.previous %}
                                    <li class="previous page-item">
                                        <div hx-get="{{table.url}}{% querystring table.prefixed_page_field=table.page.previous_page_number %}"
                                            hx-trigger="click"
                                            hx-target="closest div.table-container"
                                            hx-swap="innerHTML"
                                            class="page-link">
                                            <i class="previous"></i>
                                        </div>
                                    </li>
                                {% endblock pagination.previous %}
                            {% endif %}
                            {% if table.page.has_previous or table.page.has_next %}
                                {% block pagination.range %}
                                    {% for p in table.page|table_page_range:table.paginator %}
                                        <li class="page-item{% if table.page.number == p %} active{% endif %}">
                                            <div class="page-link" 
                                                {% if p != '...' %}hx-get="{{table.url}}{% querystring table.prefixed_page_field=p %}"{% endif %}
                                                hx-trigger="click"
                                                hx-target="closest div.table-container"
                                                hx-swap="innerHTML"
                                            >
                                                {{ p }}
                                            </div>
                                        </li>
                                    {% endfor %}
                                {% endblock pagination.range %}
                            {% endif %}
                            {% if table.page.has_next %}
                                {% block pagination.next %}
                                    <li class="next page-item">
                                        <div hx-get="{{table.url}}{% querystring table.prefixed_page_field=table.page.next_page_number %}"
                                            hx-trigger="click"
                                            hx-target="closest div.table-container"             
                                            hx-swap="innerHTML"
                                            class="page-link">
                                            <i class="next"></i></a>
                                        </div>
                                    </li>
                                {% endblock pagination.next %}
                            {% endif %}
                        </ul>
                    </nav>
                {% endif %}
            </div>
        {% endblock pagination %}
    </div>
{% endblock table-wrapper %}

{% block table.thead %}
  {% if table.show_header %}
    <thead {{ table.attrs.thead.as_html }}>
        <tr class="text-middle fw-bold fs-6 text-uppercase gs-0 rounded-4 table-warning"
           >
            {% for column in table.columns %}
                <th class="p-3 {% if forloop.first %} mw-50px{% endif %} {% if forloop.last and column.name == action %}text-end{% endif %}"
                    {{ column.attrs.th.as_html }}
                    {% if column.orderable %}
                        hx-get="{{table.url}}{% querystring table.prefixed_order_by_field=column.order_by_alias.next %}"
                        hx-trigger="click"
                        hx-target="{% if table.custom_target %} {{custom_target}} {% else %}closest div.table-container{% endif %}"
                        hx-swap="innerHTML"
                        style="cursor: pointer;"
                    {% endif %}
                >
                    {{ column.header }}
                </th>
            {% endfor %}
        </tr>
    </thead>
  {% endif %}
{% endblock table.thead %}
{# Pagination block overrides #}



